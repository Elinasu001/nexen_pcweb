<%@ page language="java" contentType="text/html; charset=UTF-8"	pageEncoding="UTF-8"%>
<link type="text/css" rel="stylesheet" href="/css/jquery.bxslider.css">
<script type="text/javascript" src="/js/lib/jquery.bxslider.js"></script>
<script type="text/javascript" src="/js/slider.js"></script>

<%@ taglib prefix="c"      uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn"     uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" 	uri="http://java.sun.com/jsp/jstl/fmt" %>

<%@ page import="com.nexwrms.core.constants.CoreConstants" %>
<%@ page import="com.nexwrms.cfo.com.constants.WebConstants" %>
<%@ page import="com.nexwrms.core.context.AppContext" %>


<!--subContentsWrap-->
<div class="subContentsWrap">
	<div class="subContents type01">
	    <div class = "product-switch" style = "margin-top: 20px;">
            <div class = "product-switch-wrap">
                <button id = "product-tire-list-btn" class = "type10" style = "background-color: #a7a8ac">타이어</button>
                <button class = "type10" style = "background-color: #812990" disabled>엔진오일</button>
            </div>
        </div>
		<div class="descInfoState">
        <p>고객님께서 경정비 주문내역을 확인하실 수 있습니다.</p>
	        <div class="state">
	            <div class="total">total<span>${selectPrdListCnt}</span></div>
	            <select class="type04 w120 ml20"  id="searchMonth" name="searchMonth" title="기간선택">
	                <option <c:if test="${searchMonth == 0}">selected="selected"</c:if> value="0">기간선택</option>
	                <option <c:if test="${searchMonth == 3}">selected="selected"</c:if> value="3">3개월</option>
	                <option <c:if test="${searchMonth == 6}">selected="selected"</c:if> value="6">6개월</option>
	                <option <c:if test="${searchMonth == 9}">selected="selected"</c:if> value="9">9개월</option>
	            </select>
	        </div>
         </div>
    	<c:choose>
			<c:when test="${fn:length(selectPrdList) > 0}">
				<!-- 리스트가 있으면 -->
				<c:forEach var="data" items="${selectPrdList}" varStatus="status">
					<c:set var="setlCpnDcAmt" value="${data.setlCpnDcAmt}" />
					<c:set var="optNm"        value="${data.patternCd}" />
					<c:set var="optPrc"       value="${data.orderFinAmt}" />
					<c:set var="sumCnt"       value="${data.sumCnt}" />
					<c:set var="totSumCnt"    value="${data.totSumCnt}" />
					<c:set var="optSumCnt"    value="${data.optSumCnt}" />
					<c:set var="ordNoSn"      value="${data.ordNoSn}" />
					<c:set var="dlvTyDtlCd1"  value="${data.dlvTyDtlCd1}" />

					<!-- 렌탈과 구매를 먼저 구분해준다 -->
					<!-- 렌탈일때 -->
					<c:if test="${data.systemGbn == '2'}">
	             		<!--렌탈 주문내역 -->
	                	<section>
		                    <div class="proViewInfo type02">
		                       <p>
		                           <span>주문일자 <em>${data.regDtView}</em></span> <span>주문번호 <em>${data.ordNo}</em> </span> <a href="javascript:fn_orderDetail('R','${data.ordNo}','${data.carModelNm}');" class="deView" title="상세"></a>
		                       </p>
		                    </div>

		                    <table class="tbl">
		                    	<caption>주문내역</caption>
		                    	<colgroup>
			                        <col style="width:180px"/>
			                        <col />
			                        <col style="width:120px"/>
			                        <col style="width:70px"/>
			                        <col style="width:70px"/>
			                        <col style="width:80px"/>
		                        </colgroup>
	                        	<tbody>
	                            	<tr>
		                                <td class="tCenter">
		                                    <div class="proViewWrap type03">
		                                        <div class="proView">
		                                            <img src="<%=AppContext.getString(WebConstants.FileDir.IMGFILE_URL)%>${data.listImg}" alt="타이어 사진">
		                                        </div>
		                                    </div>
		                                </td>
	                               		<td>
			                                <!-- 상품정보 -->
			                                <div class="proViewInfo type04">
			                                    <ul>
			                                        <li>${data.patternCd}</li>
			                                        <li>
		                                            	<span>${data.classNm}</span>  <span>${data.seasonNm}</span> <span>${data.oeYnNm}</span> <span>${data.dispSize}</span>
			                                        </li>
			                                        <li>
		                                            	<span>${data.carInfo}</span>
		                                           </li>
		                                           <li class="abShow">
		                                               <div class="infoGroup">
		                                                   <div class="info">
		                                                       <p><span>${data.saleNm}</span></p>
		                                                       <p><span>렌탈기간</span>  <span class="con">${data.periodCdNm} </span> </p>
		                                                       <p><span>월 렌탈료</span>
		                                                       	<span class="con">
		                                                       	<c:if test="${data.monAmt == 'null' || data.monAmt == ''}">
		                                                       		${data.monAmt}
		                                                       	</c:if>
		                                                       	<c:if test="${data.monAmt != 'null' && data.monAmt != ''}">
		                                                       		<fmt:formatNumber value="${data.monAmt}" pattern="#,###" />원
		                                                       	</c:if>
		                                                       	</span>
		                                                       </p>
		                                                       <p><span>렌탈 등록비</span>
		                                                       	<span class="con">
			                                                       	<c:if test="${data.regiCdAmt == 'null' || data.regiCdAmt == ''}">
			                                                       		${data.regiCdAmt}
			                                                       	</c:if>
			                                                       	<c:if test="${data.regiCdAmt != 'null' && data.regiCdAmt != ''}">
			                                                       		<fmt:formatNumber value="${data.regiCdAmt}" pattern="#,###" />원
			                                                       	</c:if>
		                                                       	</span>
		                                                       </p>
		                                                   </div>
		                                               </div>
		                                           </li>
		                                       	</ul>
	                                   		</div>
	                                    <!-- 상품정보 -->
	                               		</td>
	                               		<td class="type03 tCenter vTop">
			                                <!-- 수량 -->
			                                <div class="quantity">
			                                    <span>수량</span>
			                                    <span class="circle02">${data.cntVal}</span>
			                                </div>
			                                <!-- 수량 -->
	                               		</td>
		                                <td class="type03 tCenter vTop">
			                                <c:if test="${data.reviewCnt == 0}">
			                                    <div class="btn w100">
				                                    <c:if test="${fn:contains(data.statCdNm, '장착완료') == true}">
				                                    	<button type="button" onclick="javascript:fn_Review('${fn:replace(data.patternCd, '\'', '_')}','R','${data.ordNo}','${data.dpPrNo}','${data.matCd}');" class="type11 w100">후기작성</button>
				                                    </c:if>
				                                    <c:if test="${fn:contains(data.statCdNm, '장착완료') == false}">
				                                    	<button type="button" onclick="javascript:fn_noReview();" class="type12 w100">후기작성</button>
				                                    </c:if>
			                                    </div>
			                                </c:if>
			                                <c:if test="${data.reviewCnt > 0}">
			                                    <div class="btn w100">
			                                     	<button type="button" onclick="javascript:fn_reviewView('${fn:replace(data.patternCd, '\'', '_')}','R','${data.ordNo}','${data.dpPrNo}','','','${data.matCd}');" class="type11 w100">후기보기</button>
			                                    </div>
			                                </c:if>
		                                </td>
	                               		<td class="tCenter vTop">
	                                    <!--계약진행-->
										   	<c:if test="${data.zstatus == '03'}">
							                    <div class="btn w100">
							                    	<button type="button" class="type06 w100 noPointer">${data.zstatusNm}</button>
							                    </div>
											</c:if>
											<c:if test="${data.zstatus != '03'}">
			                                    <div class="btn w100">
				                                    <c:if test="${fn:contains(data.statCdNm, '취소') eq true}">
				                                    	<button type="button" class="type12 w100 noPointer">${data.statCdNm}</button>
				                                    </c:if>
				                                    <c:if test="${fn:contains(data.statCdNm, '취소') eq false}">
				                                    	<button type="button" class="type13 w100 noPointer">${data.statCdNm}</button>
				                                    </c:if>
			                                    </div>
											</c:if>
		                                </td>
		                                <!--계약진행-->
		                                <td class="tCenter">
											<!-- 주문취소 시스템 -->
											<c:if test="${data.chanNm eq '온라인'}">
		                         				<c:if test="${data.statCd eq '01' or data.statCd eq '03'}">
		                          					<c:choose>
														<c:when test="${data.zstatus eq '00' or data.zstatus eq '01'}">
															<!-- 00:미존재 / 01:배송요청(Order) 일때는 전체취소 -->
															<c:if test="${data.cancelYn eq 'Y'}">
																<!-- 카드결제 -->
																<c:if test="${data.usePayMethod == '100000000000'}">
							                                        <a href="javascript:ordrCancel('STSC','${data.ordNo}','${data.usePayMethod}','${data.agencyCd}','${data.carModelNm}','${data.dispSize}','${fn:replace(data.patternCd, '\'', '_')}','${data.cntVal}');" class="deCancel" title="주문취소"></a>
																</c:if>
																<!-- 계좌이체 -->
																<c:if test="${data.usePayMethod == '010000000000'}">
																	<!-- 구매확인인 경우 -->
																	<c:if test="${data.buyConfirmYn == 'Y' or data.buyConfirmYn == 'S'}">
																		<a href="javascript:ordrCashCancel('STSC','${data.ordNo}','${data.usePayMethod}','${data.recvSeq}','${data.agencyCd}','${data.carModelNm}','${data.dispSize}','${fn:replace(data.patternCd, '\'', '_')}','${data.cntVal}');" class="deCancel" title="주문취소"></a>
																	</c:if>
																	<!-- 반품요청인 경우 -->
																	<c:if test="${data.buyConfirmYn == 'N'}">
																		<a href="javascript:ordrCashCancel('STE4','${data.ordNo}','${data.usePayMethod}','${data.recvSeq}','${data.agencyCd}','${data.carModelNm}','${data.dispSize}','${fn:replace(data.patternCd, '\'', '_')}','${data.cntVal}');" class="deCancel" title="주문취소"></a>
																	</c:if>
																	<!-- 구매확인 및 반품요청이 없는 경우 -->
																	<c:if test="${data.buyConfirmYn == ''}">
																		<a href="javascript:popOpen('/etc/cncl_guide.html', '650', '570');" class="deCancel" title="주문취소"></a>
																	</c:if>
																</c:if>
																<!-- 등록금 미결제 주문 취소 -->
																<c:if test="${data.usePayMethod == ''}">
																	<a href="javascript:ordrCancelNopay('STSC','${data.ordNo}','${data.agencyCd}','${data.carModelNm}','${data.dispSize}','${fn:replace(data.patternCd, '\'', '_')}','${data.cntVal}');" class="deCancel" title="주문취소"></a>
																</c:if>
															</c:if>
														</c:when>

														<c:when test="${data.zstatus eq '02' or data.zstatus eq '03' or data.zstatus eq '09'}">
															<!-- 02:배송요청(Delivery) / 03:배송중 /09:배송완료일때는 부분취소 -->
															<c:if test="${data.cancelYn eq 'Y'}">
																<!-- 카드결제 -->
																<c:if test="${data.usePayMethod == '100000000000'}">
																	<a href="javascript:ordrCancel('STPC','${data.ordNo}','${data.usePayMethod}','${data.agencyCd}','${data.carModelNm}','${data.dispSize}','${fn:replace(data.patternCd, '\'', '_')}','${data.cntVal}');" class="deCancel" title="주문취소"></a>
																</c:if>
																<!-- 계좌이체 -->
																<c:if test="${data.usePayMethod == '010000000000'}">
																	<!-- 구매확인인 경우 -->
																	<c:if test="${data.buyConfirmYn == 'Y' or data.buyConfirmYn == 'S'}">
																		<a href="javascript:ordrCashCancel('STPC','${data.ordNo}','${data.usePayMethod}','${data.recvSeq}','${data.agencyCd}','${data.carModelNm}','${data.dispSize}','${fn:replace(data.patternCd, '\'', '_')}','${data.cntVal}');" class="deCancel" title="주문취소"></a>
																	</c:if>
																	<!-- 반품요청인 경우 -->
																	<c:if test="${data.buyConfirmYn == 'N'}">
																		<a href="javascript:ordrCashCancel('STE4','${data.ordNo}','${data.usePayMethod}','${data.recvSeq}','${data.agencyCd}','${data.carModelNm}','${data.dispSize}','${fn:replace(data.patternCd, '\'', '_')}','${data.cntVal}');" class="deCancel" title="주문취소"></a>
																	</c:if>
																	<!-- 구매확인 및 반품요청이 없는 경우 -->
																	<c:if test="${data.buyConfirmYn == ''}">
																		<a href="javascript:popOpen('/etc/cncl_guide.html', '650', '570');" class="deCancel" title="주문취소"></a>
																	</c:if>
																</c:if>
																<!-- 등록금 미결제 주문 취소 -->
																<c:if test="${data.usePayMethod == ''}">
																	<a href="javascript:ordrCancelNopay('STPC','${data.ordNo}','${data.agencyCd}','${data.carModelNm}','${data.dispSize}','${fn:replace(data.patternCd, '\'', '_')}','${data.cntVal}');" class="deCancel" title="주문취소"></a>
																</c:if>
															</c:if>
														</c:when>
		                        					</c:choose>
		                         				</c:if>
		                         			</c:if>
		                                   <!--<a href="#" class="deCancel" title="주문취소"></a>-->
		                                </td>
                           			</tr>
                       			</tbody>
                   			</table>
		                </section>
		                <!--렌탈 주문내역 -->
					</c:if>
					<!-- 구매일때일때 -->
					<c:if test="${data.systemGbn == 1  }">
						<c:if test="${data.ordNoSn == '1' && data.parntsItemCd eq null}">
			      			<!--주문내역 -->
			                <section>
			                    <div class="proViewInfo type02">
			                        <p>
			                            <span>주문일자 <em>${data.regDtView}</em></span> <span>주문번호 <em>${data.ordNo}</em> </span> <a href="javascript:fn_orderDetail('O','${data.ordNo}','${data.carModelNm}','${data.custNo}');" class="deView" title="상세"></a>
			                        </p>
			                    </div>
			                    <table class="tbl">
			                        <caption>주문내역</caption>
			                        <colgroup>
			                            <col style="width:180px"/>
			                            <col />
			                            <col style="width:120px" />
			                            <col style="width:70px"/>
			                            <col style="width:70px"/>
			                            <col style="width:80px"/>
			                        </colgroup>
			                        <tbody>
			                            <tr>
			                                <td class="tCenter">          <!-- 타이어 이미지 -->
			                                    <div class="proViewWrap type03">
			                                        <div class="proView">
			                                            <img src="<%=AppContext.getString(WebConstants.FileDir.IMGFILE_URL)%>${data.listImg}" alt="타이어 사진">
			                                        </div>
			                                    </div>
			                                </td>
			                                <td><!-- 상품정보 -->
			                                    <div class="proViewInfo type04">
			                                        <ul>
			                                            <li>${data.patternCd}</li>
			                                            <li>
			                                                 <%-- <span>${data.classNm}</span>  <span>${data.seasonNm}</span> <span>${data.oeYnNm}</span> <span>${data.dispSize}</span> --%>
			                                                 <span>${data.classNm}</span><span>${data.dispSize}</span>
			                                            </li>
			                                            <li>
			                                                 <span>${data.carInfo} ${data.grntyNo}</span>
			                                            </li>
					                                    <c:if test="${fn:length(data.grntyNo) > 0}">
														 	<li class="guNum">
														 		 <span>보증번호 : ${data.grntyNo}</span>
														 		 <span class="use">
														 			<c:choose>
														 				<c:when test="${data.grntyUseYn eq 'N'}">
														 					미사용
														 				</c:when>
														 				<c:otherwise>
														 					사용
														 				</c:otherwise>
														 			</c:choose>
														 		 </span>
														 	</li>
					                                    </c:if>
			                                            <c:if test="${data.ordChnCd ne '17'}">
				                                            <li>
				                                                <span>구매금액 </span>
				                                                <c:if test="${(data.orderBaseAmt * data.cntVal) ne data.orderFinAmt}">
				                                                  	<span class="beforePrice02">
				                                                   <fmt:formatNumber value="${data.orderBaseAmt * data.cntVal}" pattern="#,###" />원
				                                                   <span class="arrow"></span>
				                                                  	</span>
				                                                </c:if>
				                                                <span class="price">
				                                                	<fmt:formatNumber value="${data.orderFinAmt}" pattern="#,###" />원
				                                                </span>
				                                                 <%-- <span class="beforePrice02"> <fmt:formatNumber value="${data.orderBaseAmt}" pattern="#,###" />원 <span class="arrow"></span></span> <span class="price"><fmt:formatNumber value="${data.orderFinAmt}" pattern="#,###" />원</span> --%>
				                                            </li>
			                                            </c:if>
			                                        </ul>
			                                    </div>
                                    		<!-- 상품정보 -->
                                			</td>
			                                <td class="type03 tCenter vTop"> <!-- 수량 -->
			                                    <div class="quantity">
			                                        <span>수량</span>
			                                        <span class="circle02">${data.cntVal}</span>
			                                    </div>
			                                    <!-- 수량 -->
							                </td>
			                                <td class="type03 tCenter vTop"> <!-- 후기 작성 -->
				                                <c:if test="${data.reviewCnt == 0}">
				                                    <div class="btn w100">
				                                     <!-- 장착완료일때만 후기작성를 쓸수 있다. -->
				                                    	<c:if test="${data.stat == '40'}">
															<button type="button" onclick="javascript:fn_Review('${fn:replace(data.patternCd, '\'', '_')}','O','${data.ordNo}','${data.dpPrNo}','${data.itemCd}');" class="type11 w100">후기작성</button>
														</c:if>
					                                    <!-- 아닐때는 걍 경고창 -->
					                                    <c:if test="${data.stat != '40'}">
					                                        <button type="button" onclick="javascript:fn_noReview();" class="type12 w100">후기작성</button>
					                                    </c:if>
				                                    </div>
				                                </c:if>
				                                <c:if test="${data.reviewCnt > 0}">
					                                <div class="btn w100">
					                                	<button type="button" onclick="javascript:fn_reviewView('${fn:replace(data.patternCd, '\'', '_')}','O','${data.ordNo}','${data.dpPrNo}','${data.classNm}','${data.dispSize}','${data.itemCd}');" class="type11 w100">후기보기</button>
					                                </div>
				                                </c:if>
		                                	</td>
											<!-- 구매 단건일때 버튼 이미지 -->
											<c:if test="${data.sumCnt == '1'}">
				                                <td class="tCenter vTop">
			                                		<!-- 결제완료일때 -->
					                                <c:if test="${data.stat == '20'}">
				                                    <!-- 결제완료일때 -->
					                                    <button type="button" class="type06 w100 noPointer">${data.statNm}</button>
				                                    <!-- 결제완료일때 -->
					                                </c:if>
					                                <!-- 장착진행일때 -->
					                                <c:if test="${data.stat == '0'}">
					                                	<!--장착진행-->
					                                    <div class="btn w100">
					                                    	<button type="button" class="type13 w100 noPointer">${data.statNm}</button>
					                                    	<c:if test="${data.condiGbn != '0'}">
					                                       	<%-- <span class="info" onclick="javascript:fn_ConditionPop('${data.ordNo}','${data.condiGbn}');">진행현황 ></span> --%>
					                                       		<a href="javascript:fn_ConditionPop('${data.ordNo}','${data.condiGbn}');" class="ingView mt10" title="진행현황"></a>
															</c:if>
														</div>
					                                     <!--장착진행-->
					                                </c:if>
				                                 	<!-- 장착완료일때 -->
				                                    <c:if test="${data.stat == '40'}">
					                                    <div class="btn w100">
					                                    	<button type="button" class="type11 w100 noPointer">${data.statNm}</button>
					                                        <c:if test="${data.condiGbn != '0'}">
					                                       	<%-- <span class="info" onclick="javascript:fn_ConditionPop('${data.ordNo}','${data.condiGbn}');">진행현황 ></span> --%>
					                                       		<a href="javascript:fn_ConditionPop('${data.ordNo}','${data.condiGbn}');" class="ingView mt10" title="진행현황"></a>
															</c:if>
					                                    </div>
				                                    </c:if>
				                                    <!-- 주문취소일때 -->
				                                    <c:if test="${data.stat == 'O99' or data.stat == 'I99' }">
				                                    	<!--장착진행-->
				                                        <button type="button" class="type12 w100 noPointer">${data.statNm}</button>
				                                        <!--장착진행-->
				                                    </c:if>
                                 				</td>
				                                 <td class="tCenter">
					                                 <c:if test="${data.stat == '20'}">
						                                 <c:if test="${data.rcivMthCd == '32' || data.rcivMthCd == '33' || data.rcivMthCd == '34' || data.rcivMthCd == '35' || data.rcivMthCd == '37' || data.rcivMthCd == '38' || data.rcivMthCd == '39' || data.rcivMthCd == '40'}">
						                                 	<a href="javascript:ordrO2oCancel('${data.rcivMthCd}','${data.ordNo}','${fn:replace(data.patternCd, '\'', '_')}','${data.orderFinAmt}','${data.carModelNm}','${data.dlvTyDtlCd1}');" class="deCancel" title="주문취소"></a>
						                                 </c:if>
					                                 </c:if>
				                                 </td>
											</c:if>
											<!-- 구매 다건일때  버튼 이미지-->
											<c:if test="${data.sumCnt != 1}">
				                                <td class="tCenter" rowspan="${data.sumCnt}">
				                                <%--
				                                <c:choose>
					                                <c:when test="${optSumCnt > 0  }">
						                                <td class="tCenter" rowspan="${data.sumCnt+1}">
				                                	</c:when>
				                                	<c:otherwise>
						                                <td class="tCenter" rowspan="${data.sumCnt}">
				                                	</c:otherwise>
				                                </c:choose>
				                                 --%>
				                                <%-- <td class="tCenter" rowspan="${data.sumCnt}"> --%>
					                                <!-- 결제완료일때 -->
					                                <c:if test="${data.stat == '20'}">
						                                <!--결제완료-->
						                                <button type="button" class="type06 w100 noPointer">${data.statNm}</button>
						                                <!--결제완료-->
					                                </c:if>
					                                <!-- 장착진행일때 -->
					                                <c:if test="${data.stat == '0'}">
					                                    <!--장착진행-->
					                                    <button type="button" class="type13 w100 noPointer">${data.statNm}</button>
					                                    <c:if test="${data.condiGbn != '0'}">
					                                     	<%-- <span class="info" onclick="javascript:fn_ConditionPop('${data.ordNo}','${data.condiGbn}');">진행현황 ></span> --%>
					                                    	<a href="javascript:fn_ConditionPop('${data.ordNo}','${data.condiGbn}');" class="ingView mt10" title="진행현황"></a>
														</c:if>
				                                    <!--장착진행-->
					                                </c:if>
					                                <!-- 장착완료일때 -->
					                                <c:if test="${data.stat == '40'}">
					                                	<button type="button" class="type11 w100 noPointer">${data.statNm}</button>
					                                    <c:if test="${data.condiGbn != '0'}">
					                                      	<%-- <span class="info" onclick="javascript:fn_ConditionPop('${data.ordNo}','${data.condiGbn}');">진행현황 ></span> --%>
					                                    	<a href="javascript:fn_ConditionPop('${data.ordNo}','${data.condiGbn}');" class="ingView mt10" title="진행현황"></a>
														</c:if>
					                                </c:if>
					                                <!-- 주문취소일때 -->
					                                <c:if test="${data.stat == 'O99' or data.stat == 'I99' }">
					                                	<!--장착진행-->
					                                	<button type="button" class="type12 w100 noPointer">${data.statNm}</button>
					                                    <!--장착진행-->
					                                </c:if>
				                                </td>
				                                <td class="tCenter" rowspan="${data.sumCnt}">
				                                <%--
				                                <c:choose>
					                                <c:when test="${optSumCnt > 0  }">
						                                <td class="tCenter" rowspan="${data.sumCnt+1}">
				                                	</c:when>
				                                	<c:otherwise>
						                                <td class="tCenter" rowspan="${data.sumCnt}">
				                                	</c:otherwise>
				                                </c:choose>
				                                 --%>
				                                	<c:if test="${data.stat == '20'}">
					                                    <c:if test="${data.rcivMthCd == '32' || data.rcivMthCd == '33' || data.rcivMthCd == '34' || data.rcivMthCd == '35' || data.rcivMthCd == '37' || data.rcivMthCd == '38' || data.rcivMthCd == '39'  || data.rcivMthCd == '40'}">
					                                 		<a href="javascript:ordrO2oCancel('${data.rcivMthCd}','${data.ordNo}','${fn:replace(data.patternCd, '\'', '_')}','${data.orderFinAmt}','${data.carModelNm}','${data.dlvTyDtlCd1}')" class="deCancel" title="주문취소"></a>
					                                 	</c:if>
				                                    </c:if>
				                                </td>
											</c:if>
			                            </tr>
										</c:if>
						                <c:if test="${data.ordNoSn != '1'&& data.parntsItemCd eq null }">    <!-- 구매 다건 일때  -->
							                <tr>
								                <td class="tCenter">
								                    <div class="proViewWrap type03">
								                        <div class="proView">
								                        	<img src="<%=AppContext.getString(WebConstants.FileDir.IMGFILE_URL)%>${data.listImg}" alt="타이어 사진">
								                        </div>
								                    </div>
								                </td>
							                    <td>
							                        <!-- 상품정보 -->
							                        <div class="proViewInfo type04">
				                                        <ul>
				                                            <li>${data.patternCd}</li>
				                                            <li>
				                                                 <%-- <span>${data.classNm}</span>  <span>${data.seasonNm}</span> <span>${data.oeYnNm}</span> <span>${data.dispSize}</span> --%>
				                                                 <span>${data.classNm}</span><span>${data.dispSize}</span>
				                                            </li>
				                                            <li>
				                                                 <span>${data.carInfo}</span>
				                                            </li>
						                                    <c:if test="${fn:length(data.grntyNo) > 0}">
																<li class="guNum">
																	 <span>보증번호 : ${data.grntyNo}</span>
																	 <span class="use">
																		<c:choose>
																			<c:when test="${data.grntyUseYn eq 'N'}">
																				미사용
																			</c:when>
																			<c:otherwise>
																				사용
																			</c:otherwise>
																		</c:choose>
																	 </span>
																</li>
						                                   </c:if>
				                                           <c:if test="${data.ordChnCd ne '17'}">
					                                           <li>
					                                               <span>구매금액 </span>
					                                               <c:if test="${(data.orderBaseAmt * data.cntVal) ne data.orderFinAmt}">
					                                                   <span class="beforePrice02">
						                                                   <fmt:formatNumber value="${data.orderBaseAmt * data.cntVal}" pattern="#,###" />원
						                                                   <span class="arrow"></span>
					                                                   </span>
					                                               </c:if>
				                                                   <span class="price">
				                                                       <fmt:formatNumber value="${data.orderFinAmt}" pattern="#,###" />원
				                                                   </span>
					                                           </li>
				                                            </c:if>
				                                        </ul>
				                                    </div>
							                        <!-- 상품정보 -->
							                    </td>
							                    <td class="type03 tCenter vTop">
							                        <!-- 수량 -->
							                        <div class="quantity">
							                            <span>수량</span>
							                            <span class="circle02">${data.cntVal}</span>
							                        </div>
							                        <!-- 수량 -->
							                    </td>
							                    <td class="type03 tCenter vTop">
<%-- 							                    	<c:if test="${data.reviewCnt == 0}"> --%>
<!-- 					                                    <div class="btn w100"> -->
<!-- 					                                    	장착완료일때만 후기작성를 쓸수 있다. -->
<%-- 					                                     	<c:if test="${data.stat == '40'}"> --%>
<%-- 					                                        	<button type="button" onclick="javascript:fn_Review('${fn:replace(data.patternCd, '\'', '_')}','O','${data.ordNo}','${data.dpPrNo}','${data.itemCd}');"  class="type11 w100">후기작성</button> --%>
<%-- 					                                      	</c:if> --%>
<!-- 					                                      	아닐때는 걍 경고창 -->
<%-- 					                                      	<c:if test="${data.stat != '40'}"> --%>
<!-- 					                                        	<button type="button" onclick="javascript:fn_noReview();" class="type12 w100">후기작성</button> -->
<%-- 					                                      	</c:if>							                                         --%>
<!-- 					                                    </div> -->
<%-- 					                                </c:if>    --%>
<%-- 							                        <c:if test="${data.reviewCnt > 0}"> --%>
<!-- 							                            <div class="btn w100"> -->
<%-- 															<button type="button" onclick="javascript:fn_reviewView('${fn:replace(data.patternCd, '\'', '_')}','O','${data.ordNo}','${data.dpPrNo}','','','${data.itemCd}');" class="type11 w100">후기보기</button>					                                        		                                        					                                         --%>
<!-- 							                            </div>  -->
<%-- 							                        </c:if>   					                                                                         --%>
							                    </td>
							                </tr>
						                </c:if>
						                <!-- 옵션 정보  -->
						                <c:if test="${data.ordNoSn != '1'&& data.parntsItemCd ne null && data.ordChnCd ne '17'}">    <!-- 구매 옵션 -->
							                <c:if test="${ (optSumCnt+ordNoSn-1) eq totSumCnt}" >
							                	<tr>
									                <td class="tCenter">
									                    <div class="proViewWrap type03">
									                        <div class="proView"> 옵션
									                        </div>
									                    </div>
									                </td>
								                    <td colspan="3">
								                        <!-- 상품정보 -->
								                        <div class="proViewInfo type04">
					                                        <ul>
					                                            <li></li>
							                 </c:if>
					                                            <li>
					                                                <span>${data.patternCd}  ${data.alignYnDesc} </span>
					                                                <c:if test="${(data.optBasePrc) ne data.orderFinAmt}">
					                                                  	<span class="beforePrice02">
					                                                   <fmt:formatNumber value="${data.optBasePrc}" pattern="#,###" />원
					                                                   <span class="arrow"></span>
					                                                  	</span>
					                                                </c:if>
				                                                 	<span class="price">
				                                                 		<fmt:formatNumber value="${data.orderFinAmt}" pattern="#,###" />원
				                                                 	</span>
					                                            </li>
					                       <c:if test="${totSumCnt == ordNoSn}" >
					                                        </ul>
					                                    </div>
								                        <!-- 상품정보 -->
								                    </td>
								                    <td class="type03 tCenter vTop">
								                        <!-- 수량 -->
								                        <!-- 수량 -->
								                    </td>
								                    <td class="type03 tCenter vTop">
								                    </td>
								                </tr>
								            </c:if>
						                </c:if>
						                <!-- 옵션 정보  -->
										<%-- <c:if test="${data.ordNoSn == data.sumCnt}"> --%>
										<c:if test="${totSumCnt == ordNoSn}" >
                        			</tbody>
                   				</table>
			                </section>
			                <!--주문내역 -->
						</c:if>
					</c:if>
				</c:forEach>
			</c:when>
			<c:otherwise>
				없습니다.
			</c:otherwise>
        </c:choose>
    </div>
</div>
<!--subContentsWrap-->
<!-- layerPopup // -->

<!-- 방문장착 진행현황 레이어 팝업 영역 -->
<div class="popupWrap md-modal-4" id="visitLayer"> <!-- md-show -->
	<header>
		<h2> 방문장착 진행현황<a href="#" class="layPopClose md-close"></a></h2>
	</header>
	<!--contents-->
	<div class="popContents">
       <div class="mountProcess">
           <ul id="visitIns">
           	<!-- HTML 영역 -->
           </ul>
       </div>
	</div>
	<!--contents-->
</div>
<!-- 방문장착 진행현황 레이어 팝업 영역 -->

<!-- 픽업 앤 딜리버리 레이어 팝업 영역 -->
<!-- layerPopup // -->
<div class="popupWrap md-modal-4" id="pickDelLayer"> <!-- md-show -->
	<header>
		<h2> 픽업&딜리버리 장착 진행현황<a href="#" class="layPopClose md-close"></a></h2>
	</header>

	<!--contents-->
	<div class="popContents">
        <div class="scrollBox type03" id="scrollBox03">
            <div class="mountProcess pickup">
	            <ul id="PickAndDIns">
	            	<!-- HTML 영역 -->
	            </ul>
        	</div>
       </div>
	</div>
	<!--contents-->
</div>
<!-- 픽업 앤 딜리버리 레이어 팝업 영역 -->

<!-- 썸네일 popup // -->
<div class="popupWrapGall md-modal-gall" id="modal-2" style=""> <!-- md-show -->
	<header>
		<h2>상세보기</h2>
		<a href="#" class="gallPopClose"></a>
	</header>

	<!--contents-->
	<div class="popContents">
           <div class="gallery">
			<img id="gallImg" src="/img/mypage/m_pro_01_large.jpg" />
		</div>
	</div>
	<!--contents-->
</div>
<!-- 썸네일 popup // -->


<div class="md-overlay"></div>
	<!-- layerPopup // -->

<script type="text/javascript" src="/js/lib/classie.js"></script>
<script type="text/javascript" src="/js/lib/modalEffects.js"></script>

<form id="orderInfoFrm" name="orderInfoFrm" method="post" >
	<input type="hidden" name="ordergbn"  			id="ordergbn" />   <!--  렌탈이냐 구매냐  -->
	<input type="hidden" name="ordNo"  				id="ordNo" />      <!--  주문번호  -->
	<input type="hidden" name="cancelType"  		id="cancelType" /> <!-- 취소타입  -->

	<input type="hidden" name="ordrIdxx"  		id="ordrIdxx" />
	<input type="hidden" name="good_name"  		id="good_name" />
	<input type="hidden" name="good_mny"  		id="good_mny" />
	<input type="hidden" name="good_car_name"  	id="good_car_name" />
	<input type="hidden" name="CarModelNm"  	/>

	<input type="hidden" name="cust_no"  		id="cust_no"  value="${custNo}"/>

	<input type="hidden" name="dpNo"  			id="dpNo" />
	<input type="hidden" name="classNm"  		id="classNm" value="${data.classNm}"/>
	<input type="hidden" name="dispSize"  		id="dispSize" value="${data.dispSize}"/>
	<input type="hidden" name="patternCd"  		id="patternCd" />
	<input type="hidden" name="systemGbn"  		id="systemGbn" />

	<input type="hidden" name="agencyCd"  		id="agencyCd"/>
	<input type="hidden" name="cntCdNm"  		id="cntCdNm"/>			<!-- 타이어수량 -->
	<input type="hidden" name="itemCd"  		id="itemCd" value="${data.itemCd}"/> <!-- 동현 추가 -->
	<input type="hidden" name="dlvTyDtlCd1"  	id="dlvTyDtlCd1"/> <!-- 배송 유형 상세 코드 -->
</form>

<form id="orderDetailFrm" name="orderDetailFrm" method="post" >
	<input type="hidden" name="custNo"  			id="custNo"  value="${custNo}"/>
	<input type="hidden" name="ordergbn"  			id="ordergbn" />   <!--  렌탈이냐 구매냐  -->
	<input type="hidden" name="ordNo"  				id="ordNo" />      <!--  주문번호  -->
	<input type="hidden" name="carModelNm"  		id="carModelNm" />      <!--  차량정보  -->
	<input type="hidden" name="cust_no"  			id="cust_no"  value="${custNo}"/>
</form>

<form id="monthPage" name="monthPage" method="post" >
	<input type="hidden" 	name="searchMonth"  	id="searchMonth" />
</form>

<form id="nonCustInfoFrm" name="nonCustInfoFrm" method="post" >
	<input type="hidden" name="ordNo"  	/>      							<!--  주문번호  -->
	<input type="hidden" name="custNm"  id="custNm" value="${custNm}"/>		<!-- 비회원 이름 -->
	<input type="hidden" name="mobNo"  	id="mobNo" value="${mobNo}"/>		<!-- 비회원 휴대폰 번호 -->
</form>


<script type="text/javascript">
$( document ).ready(function() {
	/* 1:1문의로 가기 */
	$('#question').on('click', function(e){
		window.location.href="/mypage/questionRegister";
    });

	$('#searchMonth').on('change', function(e){
		var month = $('#searchMonth').val();
		var frm = document.monthPage;
			 frm.searchMonth.value = month;
			 frm.action = "/mypage/orderList";
			 frm.submit();

    });

	$('#product-tire-list-btn').on('click', function() {
        window.location.href="/mypage/orderList";
    });
});

function enterSchKey() {
	var evt_code = (window.netscape) ? ev.which : event.keyCode;
	if (evt_code == 13) {
		event.keyCode = 0;
	}
}


//상세페이지로 이동
function fn_orderDetail(gbn,orderNo,carModelNm,custNo,itc){
	//yjw serverMode 변경(20220225)
	var frm = document.orderDetailFrm;
		frm.ordergbn.value = gbn;
		frm.ordNo.value = orderNo;
		frm.carModelNm.value = carModelNm;
		frm.custNo.value = custNo;
		//frm.action = "/mypage/orderDetail";
		frm.action = "/mypage/orderDetailTMS2";
		frm.submit();

}

	// 등록금 미결제 주문취소
	function ordrCancelNopay(canDsc, ordNo, agencyCd, carModelNm,dispSize,patternCd,cntCdNm){

	ComUtil.confirm("렌탈 주문을 취소 하시겠습니까?","",function(){
		$("#loadingWrap").show();
		document.onkeydown = noRefresh;
		var pUrl = "";
		//yjw serverMode 변경(20220225)
		pUrl = "/order/cancelProcNopayTMS2";

		var pSendData = {
							ordNo 		: ordNo,
							agencyCd 	: agencyCd,
							carModelNm	: carModelNm,
							dispSize	: dispSize,
							patternCd	: patternCd.replace('_','\''),
							cntCdNm		: cntCdNm
						};
			pSendData = JSON.stringify(pSendData);
		$.ajax({
		    url: pUrl,
		    type: "POST",
		    cache:false,
		    data: pSendData,
		    contentType:"application/json;charset=UTF-8",  // ajax 통신으로 보내는 타입
		    success: function(data) {
		    	ComUtil.alert(data.message);
				if(data.success == 0){
					$("#loadingWrap").hide();
					window.location.href="/mypage/orderList";
				}
		    },
		    error: function (e) {
				console.log(e);
				$("#loadingWrap").hide();
			}
		});
	});
	}

// 일반 결제 취소
function ordrCancel(canDsc, orderNo, payMthd, agencyCd,carModelNm,dispSize,patternCd,cntCdNm){
	var msg = "";

	if(payMthd == "010000000000"){
		msg = "계좌이체로 결제하신 주문취소는 회원정보에 등록된 이메일로 주문취소요청을 발급해 드립니다.\n";
		msg = msg + "이메일을 확인하여, 주문취소 해주시기 바랍니다.\n";
		msg = msg + "취소를 진행하시겠습니까?\n";
	}else{
		msg = "렌탈 주문을 취소 하시겠습니까?";
	}

	ComUtil.confirm(msg,"",function(){
		$("#loadingWrap").show();
		//yjw serverMode 제거(20220225)
		var orderPreCancel = "";
		if($("#dlvTyDtlCd1").val() == "1030"){ //전문점장착
			orderPreCancel = "/order/orderPreCancel";
		} else {
			orderPreCancel = "/order/orderPreCancelTMS2";
		}
		document.onkeydown = noRefresh;
		var frm = document.orderInfoFrm;
			frm.cancelType.value = canDsc;
			frm.ordrIdxx.value = orderNo;
			frm.agencyCd.value = agencyCd;
			frm.patternCd.value = patternCd.replace('_','\'');
			frm.dispSize.value = dispSize;
			frm.cntCdNm.value = cntCdNm;
			frm.carModelNm.value = carModelNm;
			frm.action = orderPreCancel;
			frm.submit();
	});
}

// 연동 취소
function ordrCashCancel(canDsc, ordNo, payMthd, recvSeq, agencyCd,carModelNm,dispSize,patternCd,cntCdNm){
	var msg = "";

	if(recvSeq != ""){
		if(payMthd == "010000000000"){
			msg = "계좌이체로 결제하신 주문취소는 회원정보에 등록된 이메일로 주문취소요청을 발급해 드립니다.\n";
			msg = msg + "이메일을 확인하여, 주문취소 해주시기 바랍니다.\n";
			msg = msg + "취소를 진행하시겠습니까?\n";
		}else{
			msg = "렌탈 주문을 취소 하시겠습니까?";
		}

		ComUtil.confirm(msg,"",function(){
			document.onkeydown = noRefresh;
			check_cashReceitReg(canDsc, ordNo, recvSeq, agencyCd);
		});

	} else {
		ordrCancel(canDsc, ordNo, payMthd, agencyCd,carModelNm,dispSize,patternCd,cntCdNm);
	}
}

// 현금영수증 수납거래 조회
function check_cashReceitReg(canDsc, ordNo, recvSeq, agencyCd){
	$("#loadingWrap").show();
	var pUrl = "/cash/cashReceiptsRegister";
	var pSendData = {recvSeq : recvSeq,
					   jobGb : 'D',
				 cashModType : canDsc,
			       cashOrdNo : ordNo
					};
		pSendData = JSON.stringify(pSendData);
	$.ajax({
	    url: pUrl,
	    type: "POST",
	    cache:false,
	    data: pSendData,
	    contentType:"application/json;charset=UTF-8",  // ajax 통신으로 보내는 타입
	    success: function(data) {
	    	$("#loadingWrap").hide();
	    	check_cashReceitReg_result(data, agencyCd);
	    },
	    error: function (e) {
	    	$("#loadingWrap").hide();
			console.log(e);
		}
	});

}


//수납내역결과 저장
function check_cashReceitReg_result(data, agencyCd){

	var jobGb 		= data.jobGb;
	var recvSeq 	= data.recvSeq;
	var cashSeq 	= data.cashSeq;
	var cashIseq 	= data.cashIseq;
	var resCd 		= data.resCd;
	var resMsg 		= data.resMsg;
	var cash_no 	= data.cash_no;
	var receipt_no 	= data.receipt_no;
	var app_time 	= data.app_time;
	var reg_stat 	= data.reg_stat;
	var reg_desc 	= data.reg_desc;
	var regId 		= data.regId;
	var cashOrdNo 	= data.cashOrdNo;
	var cashModType = data.cashModType;
	var agencyCd 	= agencyCd;

	var pUrl = "/cash/cashReceiptsRegisterOut";
	var pSendData = {
						jobGb 		: jobGb,
		  		      	recvSeq 	: recvSeq,
		  		      	cashSeq 	: cashSeq,
		  		      	cashIseq 	: cashIseq,
		  		      	resCd 		: resCd,
		  		      	resMsg 		: resMsg,
		  		      	cashNo	 	: cash_no,
		  		      	receiptNo 	: receipt_no,
		  		      	appTime 	: app_time,
		  		      	regStat 	: reg_stat,
		  		      	regDesc 	: reg_desc,
		  		      	regId 		: regId,
		  		      	cashOrdNo 	: cashOrdNo,
		  		      	cashModType : cashModType
					};
		pSendData = JSON.stringify(pSendData);

	$.ajax({
	    url: pUrl,
	    type: "POST",
	    cache:false,
	    data: pSendData,
	    contentType:"application/json;charset=UTF-8",  // ajax 통신으로 보내는 타입
	    success: function(data) {
	    	check_cashReceitReg_result_save(data, agencyCd);
	    },
	    error: function (e) {
	    	ComUtil.alert("현금영수증 수납거래번호 정보가 없습니다.고객센터에 문의하세요...");
		}
	});
}

function check_cashReceitReg_result_save(data, agencyCd){

    var cashOrdNo    =      data.cashOrdNo;
    var cashModType  =      data.cashModType;
    var agencyCd     =      agencyCd;
    var orderPreCancel = "";
  	//yjw serverMode 변경(20220225)
	if($("#dlvTyDtlCd1").val() == "1030"){ //전문점장착
		orderPreCancel = "/order/orderPreCancel";
	} else {
		orderPreCancel = "/order/orderPreCancelTMS2";
	}
	var frm = document.orderInfoFrm;
	frm.cancelType.value 	= cashModType;
	frm.ordrIdxx.value		= cashOrdNo;
	frm.agencyCd.value 		= agencyCd;

	frm.action = orderPreCancel;
	frm.submit();
}

//팝업 가운데 띄우기
function popOpen(sUrl, sw, sh) {
 	var cw = screen.availWidth;     //화면 넓이
	var ch = screen.availHeight;    //화면 높이
	var ml=(cw-sw)/2;               //가운데 띄우기위한 창의 x위치
 	var mt=(ch-sh)/2;               //가운데 띄우기위한 창의 y위치

 	var popUp = window.open(sUrl, 'popup', 'width='+sw+', height='+sh+', top='+mt+', left='+ml+', resizable=no, scrollbars=yes');
}


// 결제 중 새로고침 방지 샘플 스크립트
function noRefresh(){
    /* CTRL + N키 막음. */
    if ((event.keyCode == 78) && (event.ctrlKey == true)){
        event.keyCode = 0;
        return false;
    }
    /* F5 번키 막음. */
    if(event.keyCode == 116){
        event.keyCode = 0;
        return false;
    }
}

function fn_noReview(){
	ComUtil.alert("후기작성를 쓰실수 없습니다.(장착 완료 후 활성화 됩니다.)");
	return false;
}

function ordrO2oCancel(rcivMthCd, ordNo, patternCd, orderFinAmt,carName, dlvTyDtlCd1){
	$('#ordrIdxx').val(ordNo);
	$('#good_name').val(patternCd.replace('_','\''));
	$('#good_mny').val(orderFinAmt);
	$('#good_car_name').val(carName);
	$('#dlvTyDtlCd1').val(dlvTyDtlCd1);

	if(rcivMthCd == '40') {
		ComUtil.alert("고객님, 주문취소가 필요하신가요?<br><br> 오픈마켓에서 주문하신 경우 <br>	결제하신 오픈마켓에서 취소 가능해요. <br><br> 만약 직접 취소가 어려우시다면, <br> 저희 고객센터(1855-0100)로 연락해주시면  <br> 친절히 도와드리겠습니다.<br><br>※ 고객센터 운영 시간  <br>평일 09:00~18:00 / 토요일, 공휴일 휴무 ");
	} else {
		ComUtil.confirm("주문을 취소하시겠습니까?","",function(){
			if(rcivMthCd == '32'  || rcivMthCd == '33'){
				fnKcpOrderCncl();
			}else if(rcivMthCd == '34' || rcivMthCd == '35'){
				fnKcpOrderKkoCncl();
			}else if(rcivMthCd == '37' || rcivMthCd == '38' || rcivMthCd == '39'){
				fnNpayOrderCncl();
			}else{
				ComUtil.alert("온라인취소가 불가능한 주문입니다. 넥센 고객센터에 문의바랍니다.");
			}
		});
	}

}


function fnKcpOrderCncl(){
	var reqId = 'fnKcpOrderCncl';
	//yjw serverMode 변경(20220225)
	var url = "";
	if($("#dlvTyDtlCd1").val() == "1030"){ //전문점장착
		url = '/order/processOrdCncl';
	}else { //방문장착, PnD
		url = '/order/processOrdCnclTMS2';
	}
	var sendJson = {};

	sendJson.ordrIdxx 	= $("#ordrIdxx").val();	//주문번호
	sendJson.mobYn	  	= "";
	sendJson.goodName 	= $("#good_name").val();	//상품명이겠고
	sendJson.amount	  	= $("#good_mny").val();		//상품가격에 수량
	sendJson.buyrName 	= "";
	sendJson.buyrMail 	= "";
	sendJson.buyrTel1 	= "";
	sendJson.buyrTel2 	= "";
	sendJson.custNo	  	= $("#cust_no").val();
	sendJson.moduleDesc = "";
	sendJson.carModelNm = $("#good_car_name").val();

	$("#loadingWrap").show();
	/* 리퀘스트 함수 */
	AjaxUtil.call(
			url,
			JSON.stringify(sendJson),
			function(result){
		    	console.log('success callback : ' + reqId, result);
		    	cfnRequestSuccessCallback(reqId, result);
			},
			{
				contentType:"application/json;charset=UTF-8",
			    fcb: function (request, status, error) {
			    	$("#loadingWrap").hide();
					console.log('error callback : ' + reqId, status);
					cfnRequestErrorCallback(reqId, status);
				}
			}
	);
}

function cfnRequestErrorCallback(callback, status) {
	if(callback == 'fnKcpOrderCncl'){
		ComUtil.alert("취소되었습니다.");
		location.href = "/mypage/orderList";
	}else if(callback == 'fnNpayOrderCncl'){
		ComUtil.alert("취소되었습니다.");
		location.href = "/mypage/orderList";
	}
}

function fnKcpOrderKkoCncl(){
	var reqId = 'fnKkoOrder';
	//yjw serverMode 변경(20220225)
	var url = "";
	if($("#dlvTyDtlCd1").val() == "1030"){ //전문점장착
		url = '/order/processOrdKkoCncl';
	}else { //방문장착, PnD
		url = '/order/processOrdKkoCnclTMS2';
	}

	var sendJson = {};
	sendJson.ordrIdxx 	= $("#ordrIdxx").val();	//주문번호
	sendJson.mobYn	  	= "";
	sendJson.goodName 	= $("#good_name").val();	//상품명이겠고
	sendJson.amount	  	= $("#good_mny").val();		//상품가격에 수량
	sendJson.buyrName 	= "";
	sendJson.buyrMail 	= "";
	sendJson.buyrTel1 	= "";
	sendJson.buyrTel2 	= "";
	sendJson.custNo	  	= $("#cust_no").val();
	sendJson.moduleDesc = "";
	sendJson.carModelNm = $("#good_car_name").val();

	$("#loadingWrap").show();
	/* 리퀘스트 함수 */
	AjaxUtil.call(
			url,
			JSON.stringify(sendJson),
			function(result){
				console.log(result.result);
		    	cfnRequestSuccessCallback(reqId, result);
			},
			{
				contentType:"application/json;charset=UTF-8",
			    fcb: function (request, status, error) {
			    	$("#loadingWrap").hide();
					console.log('error callback : ' + reqId, status);
					cfnRequestErrorCallback(reqId, status);
				}
			}
	);
}

/*
 * 리퀘스트 후처리 함수 - SUCCESS
 */
function cfnRequestSuccessCallback(callback, result) {
	$("#loadingWrap").hide();
	if(result.result == "error"){
		if(callback == "fnKcpOrderCncl"){
			ComUtil.alert("실패: " + result.Message);
		}else if(callback == "fnKkoOrder"){
			ComUtil.alert("실패: " + result.Message);
		}else if(callback == "fnNpayOrderCncl"){
			ComUtil.alert("실패: " + result.Message);
		}
	}else{
		ComUtil.alert("취소되었습니다.");
	}

	if(!ValidUtil.isEmpty($("#mobNo").val())) {//비회원
		var frm = document.nonCustInfoFrm;
		frm.action = "/mypage/orderList";
		frm.ordNo.value = $('#ordrIdxx').val();
		frm.submit();
	} else {//회원
		window.location.href="/mypage/orderList";
	}
}

//fnNpayOrderCncl by JO
function fnNpayOrderCncl(){
	//yjw serverMode 변경(20220225)
	var url = "";
	if($("#dlvTyDtlCd1").val() == "1030"){ //전문점장착
		url = '/order/processOrdNPayCncl';
	}else { //방문장착, PnD
		url = '/order/processOrdNPayCnclTMS2';
	}
	var reqId = 'fnNpayOrderCncl';

	var sendJson = {};
	sendJson.merchantPayKey	= $("#ordrIdxx").val();		//주문번호
	sendJson.productName 	= $("#good_name").val();	//상품명
	sendJson.productCount	= $("#cntCdNm").val();		//수량
	sendJson.custNo	  		= $("#cust_no").val();
	sendJson.carModelNm 	= $("#good_car_name").val();
	sendJson.bhfType 		= $("#bhfType").val();

	$("#loadingWrap").show();
	/* 리퀘스트 함수 */
	AjaxUtil.call(
		url,
		JSON.stringify(sendJson),
		function(result){
			console.log(result.result);
	    	cfnRequestSuccessCallback(reqId, result);
		},
		{
			contentType:"application/json;charset=UTF-8",
		    fcb: function (request, status, error) {
		    	$("#loadingWrap").hide();
				console.log('error callback : ' + reqId, status);
				cfnRequestErrorCallback(reqId, status);
			}
		}
	);
}
// End by JO


function fn_ConditionPop(ordNo,condiGbn){
		if(condiGbn == '1'){//방문장착
		fn_visitCondition(ordNo);
	}else if(condiGbn != '1'){//픽업 앤 딜리버리
		fn_pickUpAnddelivery(ordNo);
	}else{
		ComUtil.alert("진행현황을 조회하실 수 없습니다.");
	}
}

/* 방문장착 현황 불러오기 */
function fn_visitCondition(ordNo){

	var pUrl = "/mypage/selectVisitCondition";
	var pSendData = {ordNo : ordNo};
		pSendData = JSON.stringify(pSendData);
		$("#loadingWrap").show();
	$.ajax({
	    url: pUrl,
	    type: "POST",
	    cache:false,
	    data: pSendData,
	    contentType:"application/json;charset=UTF-8",  // ajax 통신으로 보내는 타입
	    success: function(data) {
	    	$("#loadingWrap").hide();
	    	fn_createVisitCondition(data);
	    },
	    error: function (e) {
	    	$("#loadingWrap").hide();
			console.log(e);
		}
	});
}

/* 방문장착 영역 생성 */
function fn_createVisitCondition(data){
	var innerHtml = '';
	$('#visitIns').children().remove();

	innerHtml += '<li class="on">';
	innerHtml += '<div class="pInfoView">';
	innerHtml += '<div class="process">';
	innerHtml += '<span class="pState">진행</span>';
	innerHtml += '</div>';
	innerHtml += '<div class="processCon">';
	innerHtml += '<ul class="pTit">';
	innerHtml += '<li>01</li>';
	innerHtml += '<li>매니저 픽업</li>';
	innerHtml += '</ul>';
	innerHtml += '<dl>';

	innerHtml += '<dt>희망일시</dt>';
	innerHtml += '<dd>'+ data.visitCond.dueDe +' '+ data.visitCond.dueTime +'</dd>';

	innerHtml += '</dl>';
	innerHtml += '<dl>';

	innerHtml += '<dt>방문일시</dt>';
	innerHtml += '<dd>'+ data.visitCond.dueDe +' '+ data.visitCond.appnTime +'</dd>';

	innerHtml += '</dl>';
	innerHtml += '</div>';
	innerHtml += '</div>';
	innerHtml += '</li>';
	if(data.visitCond.arvlTime != '' && data.visitCond.arvlTime != null){
		innerHtml += '<li class="on">';
	}else{
		innerHtml += '<li>';
	}

	innerHtml += '<div class="pInfoView">';
	innerHtml += '<div class="process">';
	innerHtml += '<span class="pState">진행</span>';
	innerHtml += '</div>';
	innerHtml += '<div class="processCon">';
	innerHtml += '<ul class="pTit">';
	innerHtml += '<li>02</li>';
	innerHtml += '<li>도착 및 작업시작</li>';
	innerHtml += '</ul>';
	innerHtml += '<dl>';
	innerHtml += '<dt>방문완료</dt>';
	if(data.visitCond.arvlTime != '' && data.visitCond.arvlTime != null){
		innerHtml += '<dd>'+ data.visitCond.dueDe +' '+ data.visitCond.arvlTime +'</dd>';
	}else{
		innerHtml += '<dd></dd>';
	}
	innerHtml += '</dl>';
	innerHtml += '</div>';
	innerHtml += '</div>';
	innerHtml += '</li>';


	if(data.visitCond.endTime != '' && data.visitCond.endTime != null){
		innerHtml += '<li class="mSlider on">';
	}else{
		innerHtml += '<li class="mSlider">';
	}

	innerHtml += '<div class="pInfoView">';
	innerHtml += '<div class="process">';
	innerHtml += '<span class="pState">진행</span>';
	innerHtml += '</div>';
	innerHtml += '<div class="processCon">';
	innerHtml += '<ul class="pTit">';
	innerHtml += '<li>03</li>';
	innerHtml += '<li>장착 작업완료</li>';
	innerHtml += '</ul>';
	innerHtml += '<dl>';

	if(data.visitCond.endTime != '' && data.visitCond.endTime != null){
		innerHtml += '<dt>장착완료</dt>';
		innerHtml += '<dd>'+ data.visitCond.dueDe +' '+ data.visitCond.endTime +'</dd>';
	}else{
		innerHtml += '<dd></dd>';
	}
	innerHtml += '</dl>';
	innerHtml += '<p class="mResult">';
	if(data.visitAttFList.length > 0 ){
		if(data.visitAttFList[0].regFileNm != null){
			innerHtml += '<a href="#" class="moShow">장착결과확인</a>';
		}
	}
	innerHtml += '</p>';
	innerHtml += '</div>';
	innerHtml += '</div>';

	innerHtml += '<div class="addView">';
	innerHtml += '<ul class="bxslider3">';

	for(var i=0; i < data.visitAttFList.length; i++) {
		if(data.visitAttFList[i].regFileNm != null){
			innerHtml += '<li>';
			innerHtml += '<div>';
			var imgurl = "<%=AppContext.getString(WebConstants.FileDir.IMGFILE_URL)%>";
			innerHtml += '<a href="#">';
				innerHtml += '<img src="'+imgurl+''+ data.visitAttFList[i].afilePath +'/'+ data.visitAttFList[i].regFileNm +'" data-large="'+imgurl+''+ data.visitAttFList[i].afilePath +'/'+ data.visitAttFList[i].regFileNm +'" alt="장착이미지" /> <span>'+ data.visitAttFList[i].cmCdNm +'</span>';
			innerHtml += '</a>';
			innerHtml += '</div>';
			innerHtml += '</li>';
		}
	}

	innerHtml += '</ul>';
	innerHtml += '</div>';
	innerHtml += '</li>';

	console.log("innerHtml1   : "+innerHtml);

	$('#visitIns').html(innerHtml);


	var bx3 = $('.bxslider3').bxSlider({
		 slideWidth: 210,
		 slideMargin: 1,
		 minSlides: 1,
		 maxSlides: 3,
		 moveSlides: 1,
		 pager:false
    });

    //toggle show hide
    $(".moShow").on("click", function(e){
        var target = $(this).parent().parent().parent().next('.addView');
        $(this).toggleClass("expanded");
        target.slideToggle();
        $('.addView').not(target).slideUp();

/* 	        $(this).reloadSlider = function(settings) {
            if (settings !== undefined) { options = settings; }
            el.destroySlider();
            init();
            //store reference to self in order to access public functions later
            $(el).data('bxSlider', this);
          };
         */
        bx3.reloadSlider();
    });

    $(".addView a img").click(function(){
		 var idx = $(this).index();
		 var $imgShow = $(this);

		 $('.popupWrapGall').eq(idx).addClass('md-show');
		 $("#gallImg").attr("src", $imgShow.attr("data-large"));
	});

	$(".gallPopClose").click(function(){
		$(".popupWrapGall").removeClass('md-show');
	});

	$("#visitLayer").addClass("md-show");
}

function fn_pickUpAnddelivery(ordNo){

	var pUrl = "/mypage/selectPickAndDel";
	var pSendData = {ordNo : ordNo};
		pSendData = JSON.stringify(pSendData);
	$.ajax({
	    url: pUrl,
	    type: "POST",
	    cache:false,
	    data: pSendData,
	    contentType:"application/json;charset=UTF-8",  // ajax 통신으로 보내는 타입
	    success: function(data) {
	    	fn_createPickUpAnddelivery(data);
	    },
	    error: function (e) {
			console.log(e);
		}
	});
}

function fn_createPickUpAnddelivery(data){
	var innerHtml = '';
		$('#PickAndDIns').children().remove();

	    innerHtml += '<li class="on">';
		innerHtml += '<div class="pInfoView">';
		innerHtml += '<div class="process">';
		innerHtml += '<span class="pState">진행</span>';
		innerHtml += '</div>';
		innerHtml += '<div class="processCon">';
		innerHtml += '<ul class="pTit">';
		innerHtml += '<li>01</li>';
		innerHtml += '<li>매니저 픽업</li>';
		innerHtml += '</ul>';


		innerHtml += '<dl>';
		innerHtml += '<dt>희망일시</dt>';
		innerHtml += '<dd>'+ data.pickDel.dueDe1 +' '+ data.pickDel.dueTime1 +'</dd>';
		innerHtml += '</dl>'


		if(data.pickDel.appnTime1 != null && data.pickDel.appnTime1 != ''){
			innerHtml += '<dl>';
			innerHtml += '<dt>방문일시</dt>';
			innerHtml += '<dd>'+ data.pickDel.dueDe1 +' '+ data.pickDel.appnTime1 +'</dd>';
			innerHtml += '</dl>';
		}

		innerHtml += '</div>';
		innerHtml += '</div>';
		innerHtml += '</li>';



		if(data.pickDel.arvlTime1 != null && data.pickDel.arvlTime1 != ''){
			innerHtml += '<li class="on">';
		}else{
			innerHtml += '<li>';
		}

		innerHtml += '<div class="pInfoView">';
		innerHtml += '<div class="process">';
		innerHtml += '<span class="pState">진행</span>';
		innerHtml += '</div>';

		innerHtml += '<div class="processCon">';
		innerHtml += '<ul class="pTit">';
		innerHtml += '<li>02</li>';
		innerHtml += '<li>도착 및 차량 키 전달받음</li>';
		innerHtml += '</ul>';

		if(data.pickDel.arvlTime1 != null && data.pickDel.arvlTime1 != ''){
			innerHtml += '<dl>';
			innerHtml += '<dt>픽업완료</dt>';
			innerHtml += '<dd>'+ data.pickDel.dueDe1 +' '+ data.pickDel.arvlTime1 +'</dd>';
			innerHtml += '</dl>';
		}

		innerHtml += '</div>';
		innerHtml += '</div>';
		innerHtml += '</li>';

		if(data.pickDel.endTime1 != null && data.pickDel.endTime1 != ''){
			innerHtml += '<li class="on">';
		}else{
			innerHtml += '<li>';
		}
		innerHtml += '<div class="pInfoView">';
		innerHtml += '<div class="process">';
		innerHtml += '<span class="pState">진행</span>';
		innerHtml += '</div>';

		innerHtml += '<div class="processCon">';
		innerHtml += '<ul class="pTit">';
		innerHtml += '<li>03</li>';
		innerHtml += '<li>장착 전 상태 체크 및 전문점 도착</li>';
		innerHtml += '</ul>';

		if(data.pickDel.endTime1 != null && data.pickDel.endTime1 != ''){

		innerHtml += '<dl>';
		innerHtml += '<dt>전문점 도착 일시</dt>';
		innerHtml += '<dd>'+ data.pickDel.dueDe2 +' '+ data.pickDel.endTime1 +'</dd>';
		innerHtml += '</dl>';

		innerHtml += '<p class="mResult">';
		innerHtml += '<a href="javascript:return false;" class="moShow">장착 전 상태</a>';
		innerHtml += '</p>';
		innerHtml += '</div>';
		innerHtml += '</div>';

		innerHtml += '<div class="addView">';
		innerHtml += '<ul class="bxslider">';

		if(data.pickDelAttFList.length > 0 ){
			for(var i=0; i < data.pickDelAttFList.length; i++) {
				if(data.pickDel.acptNo1 == data.pickDelAttFList[i].acptNo && data.pickDelAttFList[i].refCd1 == 'P'){
					console.log(data.pickDel.acptNo1+"::::11::::"+data.pickDelAttFList[i].acptNo+"::::11::::"+data.pickDelAttFList[i].refCd1);
					innerHtml += '<li>';
					innerHtml += '<div>';
					var imgurl = "<%=AppContext.getString(WebConstants.FileDir.IMGFILE_URL)%>";
					if(data.pickDelAttFList[i].regFileNm != null){
						innerHtml += '<img src="'+imgurl+''+ data.pickDelAttFList[i].afilePath +'/'+ data.pickDelAttFList[i].regFileNm +'" alt="장착이미지" /> <span>'+ data.pickDelAttFList[i].cmCdNm +'</span>';
					}
					innerHtml += '</div>';
					innerHtml += '</li>';
				}
			}
		}
		innerHtml += '</ul>';
		innerHtml += '</div>';
		}
		innerHtml += '</li>';

		if(data.pickDel.endTime2 != null && data.pickDel.endTime2 != ''){
			innerHtml += '<li class="on">';
		}else{
			innerHtml += '<li>';
		}

		innerHtml += '<div class="pInfoView">';
		innerHtml += '<div class="process">';
		innerHtml += '<span class="pState">진행</span>';
		innerHtml += '</div>';

		innerHtml += '<div class="processCon">';
		innerHtml += '<ul class="pTit">';
		innerHtml += '<li>04</li>';
		innerHtml += '<li>장착 작업완료</li>';
		innerHtml += '</ul>';

		if(data.pickDel.endTime2 != null && data.pickDel.endTime2 != ''){
			innerHtml += '<dl>';
			innerHtml += '<dt>장착완료</dt>';
			innerHtml += '<dd>'+ data.pickDel.dueDe2 +' '+ data.pickDel.endTime2 +'</dd>';
			innerHtml += '</dl>';
			innerHtml += '</div>';
			innerHtml += '</div>';
		}

		innerHtml += '</li>';


		if(data.pickDel.arvlTime3 != null && data.pickDel.arvlTime3 != ''){
			innerHtml += '<li class="on">';
		}else{
			innerHtml += '<li>';
		}
		innerHtml += '<div class="pInfoView">';
		innerHtml += '<div class="process">';
		innerHtml += '<span class="pState">진행</span>';
		innerHtml += '</div>';
		innerHtml += '<div class="processCon">';
		innerHtml += '<ul class="pTit">';
		innerHtml += '<li>05</li>';
		innerHtml += '<li>서비스 매니저 딜리버리</li>';
		innerHtml += '</ul>';


		if(data.pickDel.arvlTime3 != null && data.pickDel.arvlTime3 != ''){
			innerHtml += '<dl>';
			innerHtml += '<dt>딜리버리 일시</dt>';
			innerHtml += '<dd>'+ data.pickDel.dueDe3 +' '+ data.pickDel.arvlTime3 +'</dd>';
			innerHtml += '</dl>';
		}

		innerHtml += '</div>';
		innerHtml += '</div>';
		innerHtml += '</li>';

		if(data.pickDel.endTime3 != null && data.pickDel.endTime3 != ''){
			innerHtml += '<li class="on">';
		}else{
			innerHtml += '<li>';
		}

		innerHtml += '<div class="pInfoView">';
		innerHtml += '<div class="process">';
		innerHtml += '<span class="pState">진행</span>';
		innerHtml += '</div>';

		innerHtml += '<div class="processCon">';
		innerHtml += '<ul class="pTit">';
		innerHtml += '<li>06</li>';
		innerHtml += '<li>고객님 차량 키 전달완료</li>';
		innerHtml += '</ul>';

		if(data.pickDel.endTime3 != null && data.pickDel.endTime3 != ''){
			innerHtml += '<dl>';
			innerHtml += '<dt>딜리버리 완료</dt>';
			innerHtml += '<dd>'+ data.pickDel.dueDe3 +' '+ data.pickDel.endTime3 +'</dd>';
			innerHtml += '</dl>';
			innerHtml += '<p class="mResult">';
			innerHtml += '<a href="javascript:return false;" class="moShow">장착 후 상태</a>';
			innerHtml += '</p>';
			innerHtml += '</div>';
			innerHtml += '</div>';
			innerHtml += '<div class="addView">';
			innerHtml += '<ul class="bxslider3">';

			if(data.pickDelAttFList.length > 0 ){
				for(var i=0; i < data.pickDelAttFList.length; i++) {
					if(data.pickDel.acptNo3 == data.pickDelAttFList[i].acptNo && data.pickDelAttFList[i].refCd1 == 'D'){
					console.log(data.pickDel.acptNo1+"::::22::::"+data.pickDelAttFList[i].acptNo+"::::22::::"+data.pickDelAttFList[i].refCd1);
						innerHtml += '<li>';
						innerHtml += '<div>';
						var imgurl = "<%=AppContext.getString(WebConstants.FileDir.IMGFILE_URL)%>";
						if(data.pickDelAttFList[i].regFileNm != null){
							innerHtml += '<img src="'+imgurl+''+ data.pickDelAttFList[i].afilePath +'/'+ data.pickDelAttFList[i].regFileNm +'" alt="장착이미지" /> <span>'+ data.pickDelAttFList[i].cmCdNm +'</span>';
						}
						innerHtml += '</div>';
						innerHtml += '</li>';
					}
				}
			}
			innerHtml += '</ul>';
			innerHtml += '</div>';

		}

		innerHtml += '</li>';


	$('#PickAndDIns').html(innerHtml);


	var bx = $('.bxslider').bxSlider({
		 slideWidth: 210,
		 slideMargin: 1,
		 minSlides: 1,
		 maxSlides: 3,
		 moveSlides: 1,
		 pager:false
    });


	var bx3 = $('.bxslider3').bxSlider({
		 slideWidth: 210,
		 slideMargin: 1,
		 minSlides: 1,
		 maxSlides: 3,
		 moveSlides: 1,
		 pager:false
    });


    //toggle show hide
    $(".moShow").on("click", function(e){
        var target = $(this).parent().parent().parent().next('.addView');
        $(this).toggleClass("expanded");
        target.slideToggle();
        $('.addView').not(target).slideUp();


        bx.reloadSlider();
        bx3.reloadSlider();
    });
	$("#pickDelLayer").addClass("md-show");
	$("#scrollBox03").css("display","");

}

//1대1문의로 넘긴다.
function fn_questionList(){
	window.location.href="/mypage/questionRegister";
}

//후기작성로 넘어간다.
function fn_Review(pt,gbn,ordn,dpn,itc){
	window.location.href="/mypage/orderRivew?pattenCd="+pt.replace('_','\'')+"&reviewGbn="+gbn+"&ordNo="+ordn+"&dpNo="+dpn+"&itemCd="+itc;
}

function fn_reviewView(pt,gbn,ordn,dpn,classNm,dispSize,itc){
	var frm = document.orderInfoFrm;
		frm.ordNo.value = ordn;
		frm.dpNo.value = dpn;
		frm.patternCd.value = pt.replace('_','\'');
		frm.systemGbn.value = gbn;
		frm.classNm.value = classNm;
		frm.dispSize.value = dispSize;
		frm.itemCd.value = itc;
		frm.action = "/mypage/orderRivewView";
		frm.submit();
}

</script>
